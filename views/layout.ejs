<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/billboard/billboard.css">
    <link rel="stylesheet" href="/css/materialize.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>
        Meal Planner
    </title>
</head>



<body>

    <%- include("./partials/nav.ejs") %>
        <%- body %>
            <script type="text/javascript" src="/js/materialize.js"></script>
            <script type="text/javascript" src="/billboard/billboard.js"></script>
            <script type="text/javascript" src="/billboard/billboard.pkgd.js"></script>


            <script type="text/javascript" src="/js/autocomplete.js"></script>

            <script>
                let inline1El = document.querySelector("#inline1");
                let inline2El = document.querySelector("#inline2");
                let inline3El = document.querySelector("#inline3");
                let inline4El = document.querySelector("#inline4");

                if (inline1El !== null) {
                    document.querySelector("#inline1").addEventListener("click", function(e) {
                        if (e.target.checked) {
                            document.querySelector("#amount_inline1").style.display = "block"
                            document.querySelector(".amount_inline1").style.display = "block"
                        } else {
                            document.querySelector("#amount_inline1").style.display = "none"
                            document.querySelector(".amount_inline1").style.display = "none"
                        }
                    });
                }
                if (inline2El !== null) {
                    document.querySelector("#inline2").addEventListener("click", function(e) {
                        if (e.target.checked) {
                            document.querySelector("#amount_inline2").style.display = "block"
                            document.querySelector(".amount_inline2").style.display = "block"
                        } else {
                            document.querySelector("#amount_inline2").style.display = "none"
                            document.querySelector(".amount_inline2").style.display = "none"
                        }
                    });
                }
                if (inline3El !== null) {
                    document.querySelector("#inline3").addEventListener("click", function(e) {
                        if (e.target.checked) {
                            document.querySelector("#amount_inline3").style.display = "block"
                            document.querySelector(".amount_inline3").style.display = "block"
                        } else {
                            document.querySelector("#amount_inline3").style.display = "none"
                            document.querySelector(".amount_inline3").style.display = "none"
                        }
                    });
                }
                if (inline4El !== null) {
                    document.querySelector("#inline4").addEventListener("click", function(e) {
                        if (e.target.checked) {
                            document.querySelector("#amount_inline4").style.display = "block"
                            document.querySelector(".amount_inline4").style.display = "block"
                        } else {
                            document.querySelector("#amount_inline4").style.display = "none"
                            document.querySelector(".amount_inline4").style.display = "none"
                        }
                    });
                }


                document.querySelectorAll("#add-favourite").forEach((element) => {
                    element.addEventListener("click", function(e) {
                        console.log(e)
                        if (e.target.parentElement.parentElement.parentElement.children[0][0].checked === false) {
                            e.target.parentElement.parentElement.parentElement.children[0][0].click()
                            e.target.parentElement.parentElement.parentElement.children[0][2].click()
                            e.target.innerHTML = "check"
                            M.toast({
                                html: 'Saved!'
                            })
                        } else {
                            e.target.parentElement.parentElement.parentElement.children[0][0].click()
                            e.target.parentElement.parentElement.parentElement.children[0][2].click()
                            e.target.innerHTML = "add";
                            M.toast({
                                html: 'Removed!'
                            })
                        }
                    });
                })

                $(document).ready(function() {
                    $(".dropdown-trigger").dropdown();
                });



                if (document.querySelector("#favourites-form") !== null) {
                    document.querySelectorAll("#favourites-form").forEach((element, index) => {
                        element.addEventListener("submit", function(e) {
                            var formData = {
                                user: document.querySelectorAll('input[name="user"]')[index].value,
                                favourite: JSON.parse(document.querySelectorAll('input[name="favourite"]')[index].value),

                            };
                            e.preventDefault();
                            $.ajax({
                                type: 'post',
                                url: '/favourites',
                                data: JSON.stringify(formData),
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function() {
                                    alert("Email has been sent!");
                                }
                            });

                        })
                    })
                }

                // $(function() {
                //     $('#favourites-form').on('submit', function(e) {


                //     });
                // });

                document.addEventListener('DOMContentLoaded', function() {
                    var elems = document.querySelectorAll('.fixed-action-btn');
                    var instances = M.FloatingActionButton.init(elems);
                });

                document.addEventListener('DOMContentLoaded', function() {
                    var elems = document.querySelectorAll('.collapsible');
                    var instances = M.Collapsible.init(elems);
                });
                var tab_el = document.querySelectorAll('.tabs');
                var instance = M.Tabs.init(tab_el);



                document.addEventListener('DOMContentLoaded', function() {
                    const options = {
                        format: 'm/dd'
                    }
                    var elems = document.querySelectorAll('.datepicker');
                    var instances = M.Datepicker.init(elems, options);
                });

                document.querySelectorAll(".modal-trigger").forEach((one) => {
                    one.addEventListener("click", function(e) {
                        let recipeYield = parseInt(e.target.nextElementSibling.children[0].nextElementSibling.children[1].value)
                        let recipeCalories = parseInt(e.target.nextElementSibling.children[0].nextElementSibling.children[2].value)
                        let recipeMacroFat = parseInt(e.target.nextElementSibling.children[0].nextElementSibling.children[3].value)
                        let recipeMacroCarbs = parseInt(e.target.nextElementSibling.children[0].nextElementSibling.children[4].value)
                        let recipeMacroSugar = parseInt(e.target.nextElementSibling.children[0].nextElementSibling.children[6].value)
                        let recipeMacroProtein = parseInt(e.target.nextElementSibling.children[0].nextElementSibling.children[6].value)



                        e.target.nextElementSibling.children[0].children[1].id = "chart1"
                        e.target.nextElementSibling.children[0].children[2].id = "legend"

                        let arr = []
                        let colorsArr = [];
                        let valuesArr = []
                        console.log("<%-  valFat %>", "<%=  valSugar %>", "<%= valCarbs %>", "<%=  valProtein %>",
                            "<%= valCalories %>")

                        console.log(recipeMacroSugar, recipeYield, recipeCalories, recipeMacroCarbs, recipeMacroProtein, recipeMacroFat)

                        if ("<%= valFat %>" != 0) {
                            recipeMacroFat = recipeMacroFat / recipeYield
                            let calc = recipeMacroFat / "<%= valFat %>"
                            calc = Math.round(calc * 100)
                            let innerArr1 = ['Fat', calc]
                            arr.push(innerArr1);
                            colorsArr.push("orange");
                            valuesArr.push(0)
                            console.log(calc)

                        }

                        if ("<%= valCarbs %>" != 0) {
                            recipeMacroCarbs = recipeMacroCarbs / recipeYield
                            let calc = recipeMacroCarbs / "<%= valCarbs %>"
                            calc = Math.round(calc * 100)
                            let innerArr2 = ['Carbs', calc]
                            arr.push(innerArr2)
                            colorsArr.push("indigo");
                            valuesArr.push(0)
                            console.log(calc)


                        }

                        if ("<%= valProtein %>" != 0) {
                            recipeMacroProtein = recipeMacroProtein / recipeYield
                            let calc = recipeMacroProtein / "<%= valProtein %>"
                            calc = Math.round(calc * 100)
                            let innerArr3 = ['Protein', calc]
                            arr.push(innerArr3);
                            colorsArr.push("violet");
                            valuesArr.push(0)
                            console.log(calc)


                        }

                        if ("<%= valSugar %>" != 0) {
                            recipeMacroSugar = recipeMacroSugar / recipeYield
                            let calc = recipeMacroSugar / "<%= valSugar %>"
                            calc = Math.round(calc)
                            let innerArr4 = ['Sugar', calc]
                            arr.push(innerArr4);
                            colorsArr.push("yellow");
                            valuesArr.push(0)
                            console.log(calc)


                        }

                        if ("<%= valCalories %>") {
                            recipeCalories = recipeCalories / recipeYield
                            let calc = recipeCalories / "<%= valCalories %>"
                            calc = Math.round(calc * 100)
                            let innerArr5 = ['Calories', calc]
                            arr.push(innerArr5);
                            colorsArr.push("green");
                            valuesArr.push(0)
                            console.log(calc)


                        }

                        console.log(arr)
                        var chart1 = bb.generate({
                            data: {
                                columns: arr,
                                type: "gauge", // for ESM specify as: gauge()
                            },
                            legend: {
                                contents: {
                                    bindto: "#legend",
                                    template: "<span style='color:#fff;padding:10px;background-color:{=COLOR}'>{=TITLE}</span>"
                                }
                            },
                            gauge: {
                                type: "multi",
                                max: 100,
                                min: 0,
                                expand: true,
                                arcs: {
                                    minWidth: 5
                                },
                                width: 110,
                            },

                            size: {
                                height: 250
                            },
                            bindto: "#chart1"
                        });


                    })

                })







                document.querySelectorAll(".modal-close").forEach((one) => {
                    one.addEventListener("click", function(e) {
                        e.target.parentElement.parentElement.children[0].children[1].id = "";
                        e.target.parentElement.parentElement.children[0].children[2].id = "";


                    })
                })

                document.addEventListener('DOMContentLoaded', function() {
                    var elems = document.querySelectorAll('select');
                    var instances = M.FormSelect.init(elems);
                });
                document.addEventListener('DOMContentLoaded', function() {
                    var elems = document.querySelectorAll('.modal');
                    var instances = M.Modal.init(elems);
                });

                document.querySelector("#show-schedule").addEventListener("click", function(e) {

                    document.querySelector("#meal-schedule").style.display = "block"
                })
            </script>
            <script type="text/javascript" src="/js/dump.js"></script>

</body>

</html>